const path = require('path');

// This configuration will be merged with the main webpack config
module.exports = {
  resolve: {
    alias: {
      'react-native$': 'react-native-web',
      'react-native-web': path.resolve(__dirname, 'node_modules/react-native-web'),
    },
  },
  module: {
    rules: [
      {
        test: /\.(mjs|js|jsx)$/,
        include: [
          path.resolve(__dirname, 'node_modules/@tamagui'),
          path.resolve(__dirname, 'node_modules/tamagui'),
        ],
        use: {
          loader: 'babel-loader',
          options: {
            presets: ['@babel/preset-env'],
            plugins: ['@babel/plugin-transform-runtime'],
          }
        },
        resolve: {
          fullySpecified: false,
        },
      },
    ],
  },
  plugins: [
    // This will ensure environment variables don't get injected into the code as strings
    new (require('webpack')).DefinePlugin({
      'process.env.TAMAGUI_TARGET': JSON.stringify('web'),
      '__DEV__': process.env.NODE_ENV === 'development',
      'TAMAGUI_REACT_19': true,
      'process.env.TAMAGUI_CSS_VARIABLE_PREFIX': JSON.stringify(''),
      // Define specific variables Tamagui uses with empty values
      '{}.TAMAGUI_CSS_VARIABLE_PREFIX': JSON.stringify(''),
      '{}.TAMAGUI_REACT_19': 'false',
    }),
  ],
};
